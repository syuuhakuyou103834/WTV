# 批量处理功能使用说明

## 功能概述
新增的批量处理功能允许用户一次性处理多个初始膜厚数据文件，使用相同的参数设置和离子束强度分布进行批量刻蚀模拟。

## 使用步骤

### 1. 准备工作
- 选择离子束分布文件（必须先选择）
- 设置模拟参数（网格尺寸、分辨率、晶圆直径、目标膜厚等）
- 设置载台中心坐标和y-Step步长等参数

### 2. 开始批量处理
1. 点击左侧控制面板下方的"以当前设置参数及Beam强度进行批量处理"按钮
2. 在弹出的文件选择对话框中，多选要处理的初始膜厚数据文件（如1903.csv, 1906.csv, 1925.csv, 2711.csv）
3. 确认文件列表后，点击"是"开始批量处理

### 3. 批量处理流程
系统将依次处理每个文件：

#### 3.1 单文件处理
- 创建结果文件夹：`原文件名_simulation_result`
- 执行模拟（与单次模拟流程相同）
- 如果均一性不达标，会弹出异常值处理对话框
- 用户可选择是否删除异常点并重新模拟

#### 3.2 模拟完成
- 显示统计报告（膜厚统计、模拟过程统计）
- 询问是否生成载台运动速度Recipe
- 如果选择是，生成SMI Recipe文件并显示Recipe统计信息
- 自动生成模拟日志文件

#### 3.3 继续下一文件
- 询问是否继续处理下一个文件
- 如果选择是，清除UI统计数据，处理下一个文件
- 如果选择否，结束批量处理

### 4. 输出文件结构
对于每个处理的文件（如1903.csv），会生成以下结构：
```
原文件所在目录/
├── 1903_simulation_result/
│   ├── initial_thickness_map.csv      # 初始膜厚分布
│   ├── etching_depth_map.csv         # 刻蚀深度分布
│   ├── simulated_etch_depth.csv      # 模拟刻蚀深度
│   ├── validated_thickness_map.csv   # 验算后膜厚分布
│   ├── dwell_time_map.csv            # 停留时间地图
│   ├── velocity_map.csv              # 速度分布地图
│   ├── stage_recipe.csv              # 载台运动轨迹
│   ├── stage_Y-motor_speed_map.csv   # 载台运动速度地图
│   ├── SMI_Recipe_*.csv              # SMI指令文件
│   ├── 倍速Recipe文件（如适用）       # 2倍速或3倍速Recipe
│   └── simulation_log.html           # 模拟日志
└── 1903.csv                          # 原始文件
```

### 5. 功能特点
- **参数一致性**：所有文件使用相同的参数设置和离子束分布
- **独立处理**：每个文件独立处理，互不影响
- **完整流程**：包含异常值处理、Recipe生成、日志记录等完整功能
- **用户控制**：每个关键步骤都需要用户确认
- **进度跟踪**：显示当前处理进度和文件信息
- **错误处理**：遇到错误时可选择跳过或终止

### 6. 注意事项
1. **必须先选择离子束文件**才能开始批量处理
2. 处理过程中不能修改参数设置
3. 每个文件的处理结果保存在其原文件所在目录下
4. 批量处理过程中，"开始模拟"按钮会被禁用
5. 可以随时选择终止批量处理流程
6. 建议在开始前确认所有参数设置正确

### 7. 状态栏信息
处理过程中，状态栏会显示：
```
批量处理进度：当前序号/总文件数
正在处理：当前文件名.csv
```

### 8. 示例文件
使用 `batch test` 文件夹中的测试文件：
- 1903.csv
- 1906.csv
- 1925.csv
- 2711.csv

这些文件可以用来测试批量处理功能的完整流程。